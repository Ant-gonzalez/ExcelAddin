{"version":3,"sources":["useActiveDescendant.js"],"sourcesContent":["import * as React from 'react';\nimport { useEventCallback, useMergedRefs } from '@fluentui/react-utilities';\nimport { useOnKeyboardNavigationChange } from '@fluentui/react-tabster';\nimport { useOptionWalker } from './useOptionWalker';\nimport { ACTIVEDESCENDANT_ATTRIBUTE, ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE } from './constants';\nimport { scrollIntoView } from './scrollIntoView';\nexport const createActiveDescendantChangeEvent = (detail)=>new CustomEvent('activedescendantchange', {\n        bubbles: true,\n        cancelable: false,\n        composed: true,\n        detail\n    });\nexport function useActiveDescendant(options) {\n    const { imperativeRef, matchOption: matchOptionUnstable } = options;\n    const focusVisibleRef = React.useRef(false);\n    const shouldShowFocusVisibleAttrRef = React.useRef(true);\n    const activeIdRef = React.useRef(null);\n    const lastActiveIdRef = React.useRef(null);\n    const activeParentRef = React.useRef(null);\n    const attributeVisibilityRef = React.useRef(true);\n    const removeAttribute = React.useCallback(()=>{\n        var _activeParentRef_current;\n        (_activeParentRef_current = activeParentRef.current) === null || _activeParentRef_current === void 0 ? void 0 : _activeParentRef_current.removeAttribute('aria-activedescendant');\n    }, []);\n    const setAttribute = React.useCallback((id)=>{\n        if (id) {\n            activeIdRef.current = id;\n        }\n        if (attributeVisibilityRef.current && activeIdRef.current) {\n            var _activeParentRef_current;\n            (_activeParentRef_current = activeParentRef.current) === null || _activeParentRef_current === void 0 ? void 0 : _activeParentRef_current.setAttribute('aria-activedescendant', activeIdRef.current);\n        }\n    }, []);\n    useOnKeyboardNavigationChange((isNavigatingWithKeyboard)=>{\n        focusVisibleRef.current = isNavigatingWithKeyboard;\n        const active = getActiveDescendant();\n        if (!active) {\n            return;\n        }\n        if (isNavigatingWithKeyboard && shouldShowFocusVisibleAttrRef.current) {\n            active.setAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE, '');\n        } else {\n            active.removeAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE);\n        }\n    });\n    const matchOption = useEventCallback(matchOptionUnstable);\n    const listboxRef = React.useRef(null);\n    const { optionWalker, listboxCallbackRef } = useOptionWalker({\n        matchOption\n    });\n    const getActiveDescendant = React.useCallback(()=>{\n        var _listboxRef_current;\n        return (_listboxRef_current = listboxRef.current) === null || _listboxRef_current === void 0 ? void 0 : _listboxRef_current.querySelector(`#${activeIdRef.current}`);\n    }, [\n        listboxRef\n    ]);\n    const setShouldShowFocusVisibleAttribute = React.useCallback((shouldShow)=>{\n        shouldShowFocusVisibleAttrRef.current = shouldShow;\n        const active = getActiveDescendant();\n        if (!active) {\n            return;\n        }\n        if (shouldShow && focusVisibleRef.current) {\n            active.setAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE, '');\n        } else {\n            active.removeAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE);\n        }\n    }, [\n        getActiveDescendant\n    ]);\n    const blurActiveDescendant = React.useCallback(()=>{\n        const active = getActiveDescendant();\n        if (active) {\n            active.removeAttribute(ACTIVEDESCENDANT_ATTRIBUTE);\n            active.removeAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE);\n        }\n        removeAttribute();\n        lastActiveIdRef.current = activeIdRef.current;\n        activeIdRef.current = null;\n        var _active_id;\n        return (_active_id = active === null || active === void 0 ? void 0 : active.id) !== null && _active_id !== void 0 ? _active_id : null;\n    }, [\n        getActiveDescendant,\n        removeAttribute\n    ]);\n    const focusActiveDescendant = React.useCallback((nextActive)=>{\n        if (!nextActive) {\n            return;\n        }\n        const previousActiveId = blurActiveDescendant();\n        scrollIntoView(nextActive);\n        setAttribute(nextActive.id);\n        nextActive.setAttribute(ACTIVEDESCENDANT_ATTRIBUTE, '');\n        if (focusVisibleRef.current && shouldShowFocusVisibleAttrRef.current) {\n            nextActive.setAttribute(ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE, '');\n        }\n        const event = createActiveDescendantChangeEvent({\n            id: nextActive.id,\n            previousId: previousActiveId\n        });\n        nextActive.dispatchEvent(event);\n    }, [\n        blurActiveDescendant,\n        setAttribute\n    ]);\n    const controller = React.useMemo(()=>({\n            first: ({ passive } = {})=>{\n                const first = optionWalker.first();\n                if (!passive) {\n                    focusActiveDescendant(first);\n                }\n                return first === null || first === void 0 ? void 0 : first.id;\n            },\n            last: ({ passive } = {})=>{\n                const last = optionWalker.last();\n                if (!passive) {\n                    focusActiveDescendant(last);\n                }\n                return last === null || last === void 0 ? void 0 : last.id;\n            },\n            next: ({ passive } = {})=>{\n                const active = getActiveDescendant();\n                if (!active) {\n                    return;\n                }\n                optionWalker.setCurrent(active);\n                const next = optionWalker.next();\n                if (!passive) {\n                    focusActiveDescendant(next);\n                }\n                return next === null || next === void 0 ? void 0 : next.id;\n            },\n            prev: ({ passive } = {})=>{\n                const active = getActiveDescendant();\n                if (!active) {\n                    return;\n                }\n                optionWalker.setCurrent(active);\n                const next = optionWalker.prev();\n                if (!passive) {\n                    focusActiveDescendant(next);\n                }\n                return next === null || next === void 0 ? void 0 : next.id;\n            },\n            blur: ()=>{\n                blurActiveDescendant();\n            },\n            active: ()=>{\n                var _getActiveDescendant;\n                return (_getActiveDescendant = getActiveDescendant()) === null || _getActiveDescendant === void 0 ? void 0 : _getActiveDescendant.id;\n            },\n            focus: (id)=>{\n                if (!listboxRef.current) {\n                    return;\n                }\n                const target = listboxRef.current.querySelector(`#${id}`);\n                if (target) {\n                    focusActiveDescendant(target);\n                }\n            },\n            focusLastActive: ()=>{\n                if (!listboxRef.current || !lastActiveIdRef.current) {\n                    return;\n                }\n                const target = listboxRef.current.querySelector(`#${lastActiveIdRef.current}`);\n                if (target) {\n                    focusActiveDescendant(target);\n                    return true;\n                }\n            },\n            find (predicate, { passive, startFrom } = {}) {\n                const target = optionWalker.find(predicate, startFrom);\n                if (!passive) {\n                    focusActiveDescendant(target);\n                }\n                return target === null || target === void 0 ? void 0 : target.id;\n            },\n            scrollActiveIntoView: ()=>{\n                if (!listboxRef.current) {\n                    return;\n                }\n                const active = getActiveDescendant();\n                if (!active) {\n                    return;\n                }\n                scrollIntoView(active);\n            },\n            showAttributes () {\n                attributeVisibilityRef.current = true;\n                setAttribute();\n            },\n            hideAttributes () {\n                attributeVisibilityRef.current = false;\n                removeAttribute();\n            },\n            showFocusVisibleAttributes () {\n                setShouldShowFocusVisibleAttribute(true);\n            },\n            hideFocusVisibleAttributes () {\n                setShouldShowFocusVisibleAttribute(false);\n            }\n        }), [\n        optionWalker,\n        listboxRef,\n        setAttribute,\n        removeAttribute,\n        focusActiveDescendant,\n        blurActiveDescendant,\n        getActiveDescendant,\n        setShouldShowFocusVisibleAttribute\n    ]);\n    React.useImperativeHandle(imperativeRef, ()=>controller);\n    return {\n        listboxRef: useMergedRefs(listboxRef, listboxCallbackRef),\n        activeParentRef,\n        controller\n    };\n}\n"],"names":["createActiveDescendantChangeEvent","useActiveDescendant","detail","CustomEvent","bubbles","cancelable","composed","options","imperativeRef","matchOption","matchOptionUnstable","focusVisibleRef","React","useRef","shouldShowFocusVisibleAttrRef","activeIdRef","lastActiveIdRef","activeParentRef","attributeVisibilityRef","removeAttribute","useCallback","_activeParentRef_current","current","setAttribute","id","useOnKeyboardNavigationChange","isNavigatingWithKeyboard","active","getActiveDescendant","ACTIVEDESCENDANT_FOCUSVISIBLE_ATTRIBUTE","useEventCallback","listboxRef","optionWalker","listboxCallbackRef","useOptionWalker","_listboxRef_current","querySelector","setShouldShowFocusVisibleAttribute","shouldShow","blurActiveDescendant","ACTIVEDESCENDANT_ATTRIBUTE","_active_id","focusActiveDescendant","nextActive","previousActiveId","scrollIntoView","event","previousId","dispatchEvent","controller","useMemo","first","passive","last","next","setCurrent","prev","blur","_getActiveDescendant","focus","target","focusLastActive","find","predicate","startFrom","scrollActiveIntoView","showAttributes","hideAttributes","showFocusVisibleAttributes","hideFocusVisibleAttributes","useImperativeHandle","useMergedRefs"],"mappings":"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"}